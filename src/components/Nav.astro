---
import siteConfig, { type Link } from "../site.config";
import Hamburger from "./Hamburger.astro";
import ThemeSwitcher from "./ThemeSwitcher.astro";
import SiteIdentity from "./SiteIdentity.astro";
import NavLinks from "./NavLinks.astro";
import { withBase } from "../utils/helpers";
const { activePage } = Astro.props;
---

<header>
  <nav class="font-light w-full">
    <a href={withBase("/")}><SiteIdentity /></a>
    <div class="hidden sm:flex sm:gap-8">
      {(<NavLinks activePage={activePage} links={siteConfig.headerNavLinks} />)}
    </div>
    <ThemeSwitcher />
    <Hamburger />
  </nav>
  <div
    id="mobile-links"
    class="mobile-menu"
  >
    <div class="mobile-menu-content">
      <button
        id="close-menu"
        class="close-menu-btn"
        aria-label="Close menu"
        title="Close menu"
      >
        <svg
          width="28"
          height="28"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="transition-transform duration-300 hover:rotate-90"
        >
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
      <nav class="mobile-nav-links">
        <NavLinks
          activePage={activePage}
          links={siteConfig.headerNavLinks}
          isMobileLink={true}
        />
      </nav>
    </div>
  </div>
</header>
<script is:inline>
  document.querySelector("#hamburger-menu").addEventListener("click", () => {
    const menu = document.querySelector("#mobile-links");
    menu.classList.add("menu-open");
    document.body.style.overflow = "hidden"; // Prevent scroll when menu is open
  });

  document.querySelector("#close-menu").addEventListener("click", () => {
    const menu = document.querySelector("#mobile-links");
    menu.classList.remove("menu-open");
    document.body.style.overflow = ""; // Restore scroll
  });

  // Close menu when clicking a link
  document.querySelectorAll("#mobile-links a").forEach(link => {
    link.addEventListener("click", () => {
      const menu = document.querySelector("#mobile-links");
      menu.classList.remove("menu-open");
      document.body.style.overflow = "";
    });
  });
</script>

<style>
  .mobile-menu {
    position: fixed;
    top: 0;
    right: 0;
    width: 100%;
    height: 100vh;
    z-index: 1000;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
  }

  .mobile-menu.menu-open {
    pointer-events: auto;
    opacity: 1;
  }

  .mobile-menu-content {
    position: absolute;
    top: 0;
    right: 0;
    width: 85%;
    max-width: 400px;
    height: 100vh;
    background: rgba(0, 0, 0, 0.95);
    backdrop-filter: blur(40px) saturate(180%);
    -webkit-backdrop-filter: blur(40px) saturate(180%);
    display: flex;
    flex-direction: column;
    padding: 2rem 1.5rem;
    box-shadow: 
      -10px 0 50px rgba(0, 0, 0, 0.3),
      inset 1px 0 1px rgba(255, 255, 255, 0.1);
    transform: translateX(100%);
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  html.light .mobile-menu-content {
    background: rgba(255, 255, 255, 0.95);
    box-shadow: 
      -10px 0 50px rgba(0, 0, 0, 0.15),
      inset 1px 0 1px rgba(0, 0, 0, 0.1);
  }

  .mobile-menu.menu-open .mobile-menu-content {
    transform: translateX(0);
  }

  .close-menu-btn {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
    padding: 0.5rem;
    background: transparent;
    border: none;
    border-radius: 0.5rem;
    cursor: pointer;
    color: inherit;
    transition: all 0.3s ease;
    z-index: 10;
  }

  .close-menu-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: scale(1.1);
  }

  html.light .close-menu-btn:hover {
    background: rgba(0, 0, 0, 0.05);
  }

  .mobile-nav-links {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-top: 5rem;
    padding: 0 1rem;
  }

  .mobile-nav-links a {
    font-size: 1.5rem;
    font-weight: 300;
    padding: 1rem 1.5rem;
    border-radius: 1rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    text-decoration: none;
  }

  .mobile-nav-links a::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px;
    height: 0;
    background: var(--space-blue);
    transition: height 0.3s ease;
    border-radius: 0 2px 2px 0;
  }

  html.light .mobile-nav-links a::before {
    background: var(--space-red);
  }

  .mobile-nav-links a:hover::before {
    height: 60%;
  }

  .mobile-nav-links a:hover {
    background: rgba(59, 245, 255, 0.1);
    transform: translateX(8px);
    padding-left: 2rem;
  }

  html.light .mobile-nav-links a:hover {
    background: rgba(144, 57, 58, 0.08);
  }

  /* Backdrop overlay */
  .mobile-menu::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(8px);
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .mobile-menu.menu-open::before {
    opacity: 1;
  }

  html.light .mobile-menu::before {
    background: rgba(0, 0, 0, 0.3);
  }

  /* Hide on larger screens */
  @media (min-width: 640px) {
    .mobile-menu {
      display: none;
    }
  }

  /* Stagger animation for menu items */
  .mobile-nav-links a {
    opacity: 0;
    transform: translateX(20px);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .mobile-menu.menu-open .mobile-nav-links a {
    opacity: 1;
    transform: translateX(0);
  }

  .mobile-menu.menu-open .mobile-nav-links a:nth-child(1) {
    transition-delay: 0.1s;
  }

  .mobile-menu.menu-open .mobile-nav-links a:nth-child(2) {
    transition-delay: 0.15s;
  }

  .mobile-menu.menu-open .mobile-nav-links a:nth-child(3) {
    transition-delay: 0.2s;
  }

  .mobile-menu.menu-open .mobile-nav-links a:nth-child(4) {
    transition-delay: 0.25s;
  }

  .mobile-menu.menu-open .mobile-nav-links a:nth-child(5) {
    transition-delay: 0.3s;
  }
</style>
